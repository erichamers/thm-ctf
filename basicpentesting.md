# Basic Pentesting

Basic pentesting is mostly the hello world of pentesting in tryhackme. This is a small write up of this box.

IP: `10.10.55.120`

Starting with basic nmap scanning:
`nmap -sV -sC -oN nmap/initial $IP`

Ports opened:
```
22
80
139
445
8009
8080
```

Directory listing with gobuster:
`gobuster dir -w directory-list-2.3-medium.txt -u http://$IP`

`/development` is basically just a directory that contains two folders: `j.txt` and `dev.txt`.

Content of `j.txt`:
```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

Hints from the note:
```
Possible users:
- J
- K

* J has a weak password.
```

We can also see that J's password is weak and easily crackable.

Content of `dev.txt`:
```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

Hints from the note:
```
- Some web application might be running on the server (version 2.5.12).
- Samba is configured.
- Apache is set up.
```

Let's move on and try to enumerate samba.

`enum4linux -a $IP`

We found a share called Anonymous and in it, there's a file called staff.txt

Content of staff.txt:
```
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```

Hints from the note:
```
User J -> Jan
User K -> Kay
```

We know from the dev notes that Jan has a weak password. Since that's in the `/etc/shadow` file, maybe it means the password for `ssh` is weak. We can brute force it with hydra:

`hydra -l jan -P rockyou.txt ssh://10.10.55.120`

SSH credentials
```
username: jan
password: armando
```
Once in the box, we see two users in the home directory, `jan` and `kay`.

After enumerating the box with linpeas found kay's private key inside of `/home/kay/.ssh`. Key is password protected thought.

We can crack the password by using john the ripper.

```
./ssh2john.py key > key.hash
john key.hash
```

SSH-KEY pass: `beeswax`

Now we are able to connect to the box with user kay.

Inside of kay's home directory, we find a `pass.bak` file that contains the following password as a string: `heresareallystrongpasswordthatfollowsthepasswordpolicy$$`

The box finishes pretty much there, but just for fun, let's see if we can get root.

Using the password we found, we can run `sudo -l` to see which commands kay can run as sudo, and we get the following:

```
Matching Defaults entries for kay on basic2:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User kay may run the following commands on basic2:
    (ALL : ALL) ALL
```

Which basically just means that we can run whatever command we want as sudo as kay as long as we have the password.

By running: `sudo vim` and then `:!sh` inside of vim, we are able to get a shell as root.

Now if we go into the root folder we see that there's a flag.txt file with the following content in it:
```
Congratulations! You've completed this challenge. There are two ways (that I'm aware of) to gain 
a shell, and two ways to privesc. I encourage you to find them all!

If you're in the target audience (newcomers to pentesting), I hope you learned something. A few
takeaways from this challenge should be that every little bit of information you can find can be
valuable, but sometimes you'll need to find several different pieces of information and combine
them to make them useful. Enumeration is key! Also, sometimes it's not as easy as just finding
an obviously outdated, vulnerable service right away with a port scan (unlike the first entry
in this series). Usually you'll have to dig deeper to find things that aren't as obvious, and
therefore might've been overlooked by administrators.

Thanks for taking the time to solve this VM. If you choose to create a writeup, I hope you'll send 
me a link! I can be reached at josiah@vt.edu. If you've got questions or feedback, please reach
out to me.

Happy hacking!
```

Done!